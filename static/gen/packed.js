(function(factory){if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object"){factory(require("knockout"),exports);}else if(typeof define==="function"&&define["amd"]){define(["knockout","exports"],factory);}else{factory(ko,ko.validation={});}}(function(ko,exports){if(typeof(ko)==='undefined'){throw new Error('Knockout is required, please ensure it is loaded before loading this validation plug-in');}
ko.validation=exports;var kv=ko.validation,koUtils=ko.utils,unwrap=koUtils.unwrapObservable,forEach=koUtils.arrayForEach,extend=koUtils.extend;;var defaults={registerExtenders:true,messagesOnModified:true,errorsAsTitle:true,errorsAsTitleOnModified:false,messageTemplate:null,insertMessages:true,parseInputAttributes:false,writeInputAttributes:false,decorateInputElement:false,decorateElementOnModified:true,errorClass:null,errorElementClass:'validationElement',errorMessageClass:'validationMessage',allowHtmlMessages:false,grouping:{deep:false,observable:true,live:false},validate:{}};var configuration=extend({},defaults);configuration.html5Attributes=['required','pattern','min','max','step'];configuration.html5InputTypes=['email','number','date'];configuration.reset=function(){extend(configuration,defaults);};kv.configuration=configuration;;kv.utils=(function(){var seedId=new Date().getTime();var domData={};var domDataKey='__ko_validation__';return{isArray:function(o){return o.isArray||Object.prototype.toString.call(o)==='[object Array]';},isObject:function(o){return o!==null&&typeof o==='object';},isNumber:function(o){return!isNaN(o);},isObservableArray:function(instance){return!!instance&&typeof instance["remove"]==="function"&&typeof instance["removeAll"]==="function"&&typeof instance["destroy"]==="function"&&typeof instance["destroyAll"]==="function"&&typeof instance["indexOf"]==="function"&&typeof instance["replace"]==="function";},values:function(o){var r=[];for(var i in o){if(o.hasOwnProperty(i)){r.push(o[i]);}}
return r;},getValue:function(o){return(typeof o==='function'?o():o);},hasAttribute:function(node,attr){return node.getAttribute(attr)!==null;},getAttribute:function(element,attr){return element.getAttribute(attr);},setAttribute:function(element,attr,value){return element.setAttribute(attr,value);},isValidatable:function(o){return!!(o&&o.rules&&o.isValid&&o.isModified);},insertAfter:function(node,newNode){node.parentNode.insertBefore(newNode,node.nextSibling);},newId:function(){return seedId+=1;},getConfigOptions:function(element){var options=kv.utils.contextFor(element);return options||kv.configuration;},setDomData:function(node,data){var key=node[domDataKey];if(!key){node[domDataKey]=key=kv.utils.newId();}
domData[key]=data;},getDomData:function(node){var key=node[domDataKey];if(!key){return undefined;}
return domData[key];},contextFor:function(node){switch(node.nodeType){case 1:case 8:var context=kv.utils.getDomData(node);if(context){return context;}
if(node.parentNode){return kv.utils.contextFor(node.parentNode);}
break;}
return undefined;},isEmptyVal:function(val){if(val===undefined){return true;}
if(val===null){return true;}
if(val===""){return true;}},getOriginalElementTitle:function(element){var savedOriginalTitle=kv.utils.getAttribute(element,'data-orig-title'),currentTitle=element.title,hasSavedOriginalTitle=kv.utils.hasAttribute(element,'data-orig-title');return hasSavedOriginalTitle?savedOriginalTitle:currentTitle;},async:function(expr){if(window.setImmediate){window.setImmediate(expr);}
else{window.setTimeout(expr,0);}},forEach:function(object,callback){if(kv.utils.isArray(object)){return forEach(object,callback);}
for(var prop in object){if(object.hasOwnProperty(prop)){callback(object[prop],prop);}}}};}());;var api=(function(){var isInitialized=0,configuration=kv.configuration,utils=kv.utils;function cleanUpSubscriptions(context){forEach(context.subscriptions,function(subscription){subscription.dispose();});context.subscriptions=[];}
function dispose(context){if(context.options.deep){forEach(context.flagged,function(obj){delete obj.__kv_traversed;});context.flagged.length=0;}
if(!context.options.live){cleanUpSubscriptions(context);}}
function runTraversal(obj,context){context.validatables=[];cleanUpSubscriptions(context);traverseGraph(obj,context);dispose(context);}
function traverseGraph(obj,context,level){var objValues=[],val=obj.peek?obj.peek():obj;if(obj.__kv_traversed===true){return;}
if(context.options.deep){obj.__kv_traversed=true;context.flagged.push(obj);}
level=(level!==undefined?level:context.options.deep?1:-1);if(ko.isObservable(obj)){if(!obj.errors&&!utils.isValidatable(obj)){obj.extend({validatable:true});}
context.validatables.push(obj);if(context.options.live&&utils.isObservableArray(obj)){context.subscriptions.push(obj.subscribe(function(){context.graphMonitor.valueHasMutated();}));}}
if(val&&!val._destroy){if(utils.isArray(val)){objValues=val;}
else if(utils.isObject(val)){objValues=utils.values(val);}}
if(level!==0){utils.forEach(objValues,function(observable){if(observable&&!observable.nodeType&&(!ko.isComputed(observable)||observable.rules)){traverseGraph(observable,context,level+1);}});}}
function collectErrors(array){var errors=[];forEach(array,function(observable){if(utils.isValidatable(observable)&&!observable.isValid()){errors.push(observable.error.peek());}});return errors;}
return{init:function(options,force){if(isInitialized>0&&!force){return;}
options=options||{};options.errorElementClass=options.errorElementClass||options.errorClass||configuration.errorElementClass;options.errorMessageClass=options.errorMessageClass||options.errorClass||configuration.errorMessageClass;extend(configuration,options);if(configuration.registerExtenders){kv.registerExtenders();}
isInitialized=1;},reset:kv.configuration.reset,group:function group(obj,options){options=extend(extend({},configuration.grouping),options);var context={options:options,graphMonitor:ko.observable(),flagged:[],subscriptions:[],validatables:[]};var result=null;if(options.observable){result=ko.computed(function(){context.graphMonitor();runTraversal(obj,context);return collectErrors(context.validatables);});}
else{result=function(){runTraversal(obj,context);return collectErrors(context.validatables);};}
result.showAllMessages=function(show){if(show===undefined){show=true;}
result.forEach(function(observable){if(utils.isValidatable(observable)){observable.isModified(show);}});};result.isAnyMessageShown=function(){var invalidAndModifiedPresent;invalidAndModifiedPresent=!!result.find(function(observable){return utils.isValidatable(observable)&&!observable.isValid()&&observable.isModified();});return invalidAndModifiedPresent;};result.filter=function(predicate){predicate=predicate||function(){return true;};result();return koUtils.arrayFilter(context.validatables,predicate);};result.find=function(predicate){predicate=predicate||function(){return true;};result();return koUtils.arrayFirst(context.validatables,predicate);};result.forEach=function(callback){callback=callback||function(){};result();forEach(context.validatables,callback);};result.map=function(mapping){mapping=mapping||function(item){return item;};result();return koUtils.arrayMap(context.validatables,mapping);};result._updateState=function(newValue){if(!utils.isObject(newValue)){throw new Error('An object is required.');}
obj=newValue;if(options.observable){context.graphMonitor.valueHasMutated();}
else{runTraversal(newValue,context);return collectErrors(context.validatables);}};return result;},formatMessage:function(message,params,observable){if(utils.isObject(params)&&params.typeAttr){params=params.value;}
if(typeof message==='function'){return message(params,observable);}
var replacements=unwrap(params);if(replacements==null){replacements=[];}
if(!utils.isArray(replacements)){replacements=[replacements];}
return message.replace(/{(\d+)}/gi,function(match,index){if(typeof replacements[index]!=='undefined'){return replacements[index];}
return match;});},addRule:function(observable,rule){observable.extend({validatable:true});var hasRule=!!koUtils.arrayFirst(observable.rules(),function(item){return item.rule&&item.rule===rule.rule;});if(!hasRule){observable.rules.push(rule);}
return observable;},addAnonymousRule:function(observable,ruleObj){if(ruleObj['message']===undefined){ruleObj['message']='Error';}
if(ruleObj.onlyIf){ruleObj.condition=ruleObj.onlyIf;}
kv.addRule(observable,ruleObj);},addExtender:function(ruleName){ko.extenders[ruleName]=function(observable,params){if(params&&(params.message||params.onlyIf)){return kv.addRule(observable,{rule:ruleName,message:params.message,params:utils.isEmptyVal(params.params)?true:params.params,condition:params.onlyIf});}else{return kv.addRule(observable,{rule:ruleName,params:params});}};},registerExtenders:function(){if(configuration.registerExtenders){for(var ruleName in kv.rules){if(kv.rules.hasOwnProperty(ruleName)){if(!ko.extenders[ruleName]){kv.addExtender(ruleName);}}}}},insertValidationMessage:function(element){var span=document.createElement('SPAN');span.className=utils.getConfigOptions(element).errorMessageClass;utils.insertAfter(element,span);return span;},parseInputValidationAttributes:function(element,valueAccessor){forEach(kv.configuration.html5Attributes,function(attr){if(utils.hasAttribute(element,attr)){var params=element.getAttribute(attr)||true;if(attr==='min'||attr==='max')
{var typeAttr=element.getAttribute('type');if(typeof typeAttr==="undefined"||!typeAttr)
{typeAttr="text";}
params={typeAttr:typeAttr,value:params};}
kv.addRule(valueAccessor(),{rule:attr,params:params});}});var currentType=element.getAttribute('type');forEach(kv.configuration.html5InputTypes,function(type){if(type===currentType){kv.addRule(valueAccessor(),{rule:(type==='date')?'dateISO':type,params:true});}});},writeInputValidationAttributes:function(element,valueAccessor){var observable=valueAccessor();if(!observable||!observable.rules){return;}
var contexts=observable.rules();forEach(kv.configuration.html5Attributes,function(attr){var ctx=koUtils.arrayFirst(contexts,function(ctx){return ctx.rule&&ctx.rule.toLowerCase()===attr.toLowerCase();});if(!ctx){return;}
ko.computed({read:function(){var params=ko.unwrap(ctx.params);if(ctx.rule==="pattern"&&params instanceof RegExp){params=params.source;}
element.setAttribute(attr,params);},disposeWhenNodeIsRemoved:element});});contexts=null;},makeBindingHandlerValidatable:function(handlerName){var init=ko.bindingHandlers[handlerName].init;ko.bindingHandlers[handlerName].init=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){init(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext);return ko.bindingHandlers['validationCore'].init(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext);};},setRules:function(target,definition){var setRules=function(target,definition){if(!target||!definition){return;}
for(var prop in definition){if(!definition.hasOwnProperty(prop)){continue;}
var ruleDefinitions=definition[prop];if(!target[prop]){continue;}
var targetValue=target[prop],unwrappedTargetValue=unwrap(targetValue),rules={},nonRules={};for(var rule in ruleDefinitions){if(!ruleDefinitions.hasOwnProperty(rule)){continue;}
if(kv.rules[rule]){rules[rule]=ruleDefinitions[rule];}else{nonRules[rule]=ruleDefinitions[rule];}}
if(ko.isObservable(targetValue)){targetValue.extend(rules);}
if(unwrappedTargetValue&&utils.isArray(unwrappedTargetValue)){for(var i=0;i<unwrappedTargetValue.length;i++){setRules(unwrappedTargetValue[i],nonRules);}
}else{setRules(unwrappedTargetValue,nonRules);}}};setRules(target,definition);}};}());extend(ko.validation,api);;kv.rules={};kv.rules['required']={validator:function(val,required){var testVal;if(val===undefined||val===null){return!required;}
testVal=val;if(typeof(val)==='string'){if(String.prototype.trim){testVal=val.trim();}
else{testVal=val.replace(/^\s+|\s+$/g,'');}}
if(!required){return true;}
return((testVal+'').length>0);},message:'This field is required.'};function minMaxValidatorFactory(validatorName){var isMaxValidation=validatorName==="max";return function(val,options){if(kv.utils.isEmptyVal(val)){return true;}
var comparisonValue,type;if(options.typeAttr===undefined){type="text";comparisonValue=options;}else{type=options.typeAttr;comparisonValue=options.value;}
if(!isNaN(comparisonValue)&&!(comparisonValue instanceof Date)){type="number";}
var regex,valMatches,comparisonValueMatches;switch(type.toLowerCase()){case"week":regex=/^(\d{4})-W(\d{2})$/;valMatches=val.match(regex);if(valMatches===null){throw new Error("Invalid value for "+validatorName+" attribute for week input.  Should look like "+
"'2000-W33' http://www.w3.org/TR/html-markup/input.week.html#input.week.attrs.min");}
comparisonValueMatches=comparisonValue.match(regex);if(!comparisonValueMatches){return false;}
if(isMaxValidation){return(valMatches[1]<comparisonValueMatches[1])||((valMatches[1]===comparisonValueMatches[1])&&(valMatches[2]<=comparisonValueMatches[2]));}else{return(valMatches[1]>comparisonValueMatches[1])||((valMatches[1]===comparisonValueMatches[1])&&(valMatches[2]>=comparisonValueMatches[2]));}
break;case"month":regex=/^(\d{4})-(\d{2})$/;valMatches=val.match(regex);if(valMatches===null){throw new Error("Invalid value for "+validatorName+" attribute for month input.  Should look like "+
"'2000-03' http://www.w3.org/TR/html-markup/input.month.html#input.month.attrs.min");}
comparisonValueMatches=comparisonValue.match(regex);if(!comparisonValueMatches){return false;}
if(isMaxValidation){return((valMatches[1]<comparisonValueMatches[1])||((valMatches[1]===comparisonValueMatches[1])&&(valMatches[2]<=comparisonValueMatches[2])));}else{return(valMatches[1]>comparisonValueMatches[1])||((valMatches[1]===comparisonValueMatches[1])&&(valMatches[2]>=comparisonValueMatches[2]));}
break;case"number":case"range":if(isMaxValidation){return(!isNaN(val)&&parseFloat(val)<=parseFloat(comparisonValue));}else{return(!isNaN(val)&&parseFloat(val)>=parseFloat(comparisonValue));}
break;default:if(isMaxValidation){return val<=comparisonValue;}else{return val>=comparisonValue;}}};}
kv.rules['min']={validator:minMaxValidatorFactory("min"),message:'Please enter a value greater than or equal to {0}.'};kv.rules['max']={validator:minMaxValidatorFactory("max"),message:'Please enter a value less than or equal to {0}.'};kv.rules['minLength']={validator:function(val,minLength){if(kv.utils.isEmptyVal(val)){return true;}
var normalizedVal=kv.utils.isNumber(val)?(''+val):val;return normalizedVal.length>=minLength;},message:'Please enter at least {0} characters.'};kv.rules['maxLength']={validator:function(val,maxLength){if(kv.utils.isEmptyVal(val)){return true;}
var normalizedVal=kv.utils.isNumber(val)?(''+val):val;return normalizedVal.length<=maxLength;},message:'Please enter no more than {0} characters.'};kv.rules['pattern']={validator:function(val,regex){return kv.utils.isEmptyVal(val)||val.toString().match(regex)!==null;},message:'Please check this value.'};kv.rules['step']={validator:function(val,step){if(kv.utils.isEmptyVal(val)||step==='any'){return true;}
var dif=(val*100)%(step*100);return Math.abs(dif)<0.00001||Math.abs(1-dif)<0.00001;},message:'The value must increment by {0}.'};kv.rules['email']={validator:function(val,validate){if(!validate){return true;}
return kv.utils.isEmptyVal(val)||(validate&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(val));},message:'Please enter a proper email address.'};kv.rules['date']={validator:function(value,validate){if(!validate){return true;}
return kv.utils.isEmptyVal(value)||(validate&&!/Invalid|NaN/.test(new Date(value)));},message:'Please enter a proper date.'};kv.rules['dateISO']={validator:function(value,validate){if(!validate){return true;}
return kv.utils.isEmptyVal(value)||(validate&&/^\d{4}[-/](?:0?[1-9]|1[012])[-/](?:0?[1-9]|[12][0-9]|3[01])$/.test(value));},message:'Please enter a proper date.'};kv.rules['number']={validator:function(value,validate){if(!validate){return true;}
return kv.utils.isEmptyVal(value)||(validate&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(value));},message:'Please enter a number.'};kv.rules['digit']={validator:function(value,validate){if(!validate){return true;}
return kv.utils.isEmptyVal(value)||(validate&&/^\d+$/.test(value));},message:'Please enter a digit.'};kv.rules['phoneUS']={validator:function(phoneNumber,validate){if(!validate){return true;}
if(kv.utils.isEmptyVal(phoneNumber)){return true;}
if(typeof(phoneNumber)!=='string'){return false;}
phoneNumber=phoneNumber.replace(/\s+/g,"");return validate&&phoneNumber.length>9&&phoneNumber.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/);},message:'Please specify a valid phone number.'};kv.rules['equal']={validator:function(val,params){var otherValue=params;return val===kv.utils.getValue(otherValue);},message:'Values must equal.'};kv.rules['notEqual']={validator:function(val,params){var otherValue=params;return val!==kv.utils.getValue(otherValue);},message:'Please choose another value.'};kv.rules['unique']={validator:function(val,options){var c=kv.utils.getValue(options.collection),external=kv.utils.getValue(options.externalValue),counter=0;if(!val||!c){return true;}
koUtils.arrayFilter(c,function(item){if(val===(options.valueAccessor?options.valueAccessor(item):item)){counter++;}});return counter<(!!external?1:2);},message:'Please make sure the value is unique.'};(function(){kv.registerExtenders();}());;ko.bindingHandlers['validationCore']=(function(){return{init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var config=kv.utils.getConfigOptions(element);var observable=valueAccessor();if(config.parseInputAttributes){kv.utils.async(function(){kv.parseInputValidationAttributes(element,valueAccessor);});}
if(config.insertMessages&&kv.utils.isValidatable(observable)){var validationMessageElement=kv.insertValidationMessage(element);if(config.messageTemplate){ko.renderTemplate(config.messageTemplate,{field:observable},null,validationMessageElement,'replaceNode');}else{ko.applyBindingsToNode(validationMessageElement,{validationMessage:observable});}}
if(config.writeInputAttributes&&kv.utils.isValidatable(observable)){kv.writeInputValidationAttributes(element,valueAccessor);}
if(config.decorateInputElement&&kv.utils.isValidatable(observable)){ko.applyBindingsToNode(element,{validationElement:observable});}}};}());kv.makeBindingHandlerValidatable("value");kv.makeBindingHandlerValidatable("checked");if(ko.bindingHandlers.textInput){kv.makeBindingHandlerValidatable("textInput");}
kv.makeBindingHandlerValidatable("selectedOptions");ko.bindingHandlers['validationMessage']={update:function(element,valueAccessor){var obsv=valueAccessor(),config=kv.utils.getConfigOptions(element),val=unwrap(obsv),msg=null,isModified=false,isValid=false;if(obsv===null||typeof obsv==='undefined'){throw new Error('Cannot bind validationMessage to undefined value. data-bind expression: '+
element.getAttribute('data-bind'));}
isModified=obsv.isModified&&obsv.isModified();isValid=obsv.isValid&&obsv.isValid();var error=null;if(!config.messagesOnModified||isModified){error=isValid?null:obsv.error;}
var isVisible=!config.messagesOnModified||isModified?!isValid:false;var isCurrentlyVisible=element.style.display!=="none";if(config.allowHtmlMessages){koUtils.setHtml(element,error);}else{ko.bindingHandlers.text.update(element,function(){return error;});}
if(isCurrentlyVisible&&!isVisible){element.style.display='none';}else if(!isCurrentlyVisible&&isVisible){element.style.display='';}}};ko.bindingHandlers['validationElement']={update:function(element,valueAccessor,allBindingsAccessor){var obsv=valueAccessor(),config=kv.utils.getConfigOptions(element),val=unwrap(obsv),msg=null,isModified=false,isValid=false;if(obsv===null||typeof obsv==='undefined'){throw new Error('Cannot bind validationElement to undefined value. data-bind expression: '+
element.getAttribute('data-bind'));}
isModified=obsv.isModified&&obsv.isModified();isValid=obsv.isValid&&obsv.isValid();var cssSettingsAccessor=function(){var css={};var shouldShow=((!config.decorateElementOnModified||isModified)?!isValid:false);css[config.errorElementClass]=shouldShow;return css;};ko.bindingHandlers.css.update(element,cssSettingsAccessor,allBindingsAccessor);if(!config.errorsAsTitle){return;}
ko.bindingHandlers.attr.update(element,function(){var
hasModification=!config.errorsAsTitleOnModified||isModified,title=kv.utils.getOriginalElementTitle(element);if(hasModification&&!isValid){return{title:obsv.error,'data-orig-title':title};}else if(!hasModification||isValid){return{title:title,'data-orig-title':null};}});}};ko.bindingHandlers['validationOptions']=(function(){return{init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var options=unwrap(valueAccessor());if(options){var newConfig=extend({},kv.configuration);extend(newConfig,options);kv.utils.setDomData(element,newConfig);}}};}());;ko.extenders['validation']=function(observable,rules){forEach(kv.utils.isArray(rules)?rules:[rules],function(rule){kv.addAnonymousRule(observable,rule);});return observable;};ko.extenders['validatable']=function(observable,options){if(!kv.utils.isObject(options)){options={enable:options};}
if(!('enable'in options)){options.enable=true;}
if(options.enable&&!kv.utils.isValidatable(observable)){var config=kv.configuration.validate||{};var validationOptions={throttleEvaluation:options.throttle||config.throttle};observable.error=ko.observable(null);observable.rules=ko.observableArray();observable.isValidating=ko.observable(false);observable.__valid__=ko.observable(true);observable.isModified=ko.observable(false);observable.isValid=ko.computed(observable.__valid__);observable.setError=function(error){var previousError=observable.error.peek();var previousIsValid=observable.__valid__.peek();observable.error(error);observable.__valid__(false);if(previousError!==error&&!previousIsValid){observable.isValid.notifySubscribers();}};observable.clearError=function(){observable.error(null);observable.__valid__(true);return observable;};var h_change=observable.subscribe(function(){observable.isModified(true);});var h_obsValidationTrigger=ko.computed(extend({read:function(){var obs=observable(),ruleContexts=observable.rules();kv.validateObservable(observable);return true;}},validationOptions));extend(h_obsValidationTrigger,validationOptions);observable._disposeValidation=function(){observable.isValid.dispose();observable.rules.removeAll();h_change.dispose();h_obsValidationTrigger.dispose();delete observable['rules'];delete observable['error'];delete observable['isValid'];delete observable['isValidating'];delete observable['__valid__'];delete observable['isModified'];delete observable['setError'];delete observable['clearError'];delete observable['_disposeValidation'];};}else if(options.enable===false&&observable._disposeValidation){observable._disposeValidation();}
return observable;};function validateSync(observable,rule,ctx){if(!rule.validator(observable(),(ctx.params===undefined?true:unwrap(ctx.params)))){observable.setError(kv.formatMessage(ctx.message||rule.message,unwrap(ctx.params),observable));return false;}else{return true;}}
function validateAsync(observable,rule,ctx){observable.isValidating(true);var callBack=function(valObj){var isValid=false,msg='';if(!observable.__valid__()){observable.isValidating(false);return;}
if(valObj['message']){isValid=valObj.isValid;msg=valObj.message;}else{isValid=valObj;}
if(!isValid){observable.error(kv.formatMessage(msg||ctx.message||rule.message,unwrap(ctx.params),observable));observable.__valid__(isValid);}
observable.isValidating(false);};kv.utils.async(function(){rule.validator(observable(),ctx.params===undefined?true:unwrap(ctx.params),callBack);});}
kv.validateObservable=function(observable){var i=0,rule,ctx,ruleContexts=observable.rules(),len=ruleContexts.length;for(;i<len;i++){ctx=ruleContexts[i];if(ctx.condition&&!ctx.condition()){continue;}
rule=ctx.rule?kv.rules[ctx.rule]:ctx;if(rule['async']||ctx['async']){validateAsync(observable,rule,ctx);}else{if(!validateSync(observable,rule,ctx)){return false;}}}
observable.clearError();return true;};;var _locales={};var _currentLocale;kv.defineLocale=function(name,values){if(name&&values){_locales[name.toLowerCase()]=values;return values;}
return null;};kv.locale=function(name){if(name){name=name.toLowerCase();if(_locales.hasOwnProperty(name)){kv.localize(_locales[name]);_currentLocale=name;}
else{throw new Error('Localization '+name+' has not been loaded.');}}
return _currentLocale;};kv.localize=function(msgTranslations){var rules=kv.rules;for(var ruleName in msgTranslations){if(rules.hasOwnProperty(ruleName)){rules[ruleName].message=msgTranslations[ruleName];}}};(function(){var localeData={};var rules=kv.rules;for(var ruleName in rules){if(rules.hasOwnProperty(ruleName)){localeData[ruleName]=rules[ruleName].message;}}
kv.defineLocale('en-us',localeData);})();_currentLocale='en-us';;ko.applyBindingsWithValidation=function(viewModel,rootNode,options){var node=document.body,config;if(rootNode&&rootNode.nodeType){node=rootNode;config=options;}
else{config=rootNode;}
kv.init();if(config){config=extend(extend({},kv.configuration),config);kv.utils.setDomData(node,config);}
ko.applyBindings(viewModel,node);};var origApplyBindings=ko.applyBindings;ko.applyBindings=function(viewModel,rootNode){kv.init();origApplyBindings(viewModel,rootNode);};ko.validatedObservable=function(initialValue,options){if(!options&&!kv.utils.isObject(initialValue)){return ko.observable(initialValue).extend({validatable:true});}
var obsv=ko.observable(initialValue);obsv.errors=kv.group(kv.utils.isObject(initialValue)?initialValue:{},options);obsv.isValid=ko.observable(obsv.errors().length===0);if(ko.isObservable(obsv.errors)){obsv.errors.subscribe(function(errors){obsv.isValid(errors.length===0);});}
else{ko.computed(obsv.errors).subscribe(function(errors){obsv.isValid(errors.length===0);});}
obsv.subscribe(function(newValue){if(!kv.utils.isObject(newValue)){newValue={};}
obsv.errors._updateState(newValue);obsv.isValid(obsv.errors().length===0);});return obsv;};;}));(function(factory){if(typeof require==='function'&&typeof exports==='object'&&typeof module==='object'){module.exports=factory(require('../'));}else if(typeof define==='function'&&define['amd']){define(['knockout.validation'],factory);}else{factory(ko.validation);}}(function(kv){if(!kv||typeof kv.defineLocale!=='function'){throw new Error('Knockout-Validation is required, please ensure it is loaded before this localization file');}
return kv.defineLocale('nb-NO',{required:'Dette feltet er obligatorisk',min:'Fyll inn en verdi som er større eller lik {0}',max:'Fyll inn en verdi som er mindre eller lik {0}',minLength:'Fyll inn minst {0} tegn',maxLength:'Fyll inn færre enn {0} tegn',pattern:'Vennligst kontrollér verdien',step:'Verdien må økes med {0}',email:'Dette er ikke en korrekt e-postadresse',date:'Fyll inn en korrekt dato',dateISO:'Fyll inn en korrekt dato',number:'Fyll inn ett nummer',digit:'Fyll inn ett siffer',phoneUS:'Vennlist spesifiser ett korrekt telefonnummer',equal:'Verdiene må være like',notEqual:'Vennligst velg en annen verdi',unique:'Vennligst sørg for at verdien er unik'});}));$(function(){ko.validation.locale('nb-NO');"use strict";function sortNumber(a,b){return a-b;}
function ProductModel(rootModel){var self=this;self.products=ko.observableArray();self.flat_products=ko.computed(function(){return flatten_products(self.products());});function flatten_products(products){var r=[];if(products){for(var i=0;i<products.length;i++){var m=products[i];for(var j=0;j<m.product_types.length;j++){var d=m.product_types[j];for(var k=0;k<d.products.length;k++){var p=d.products[k];p.manufacturor=m.name;p.name=m.name+" "+d.name+" "+p.effect+"W";if('watt_per_meter'in d){p.watt_per_meter=d.watt_per_meter;}
if('watt_per_square_meter'in d){p.watt_per_square_meter=d.watt_per_square_meter;}
r.push(p);}}}}
return r;}
self.filtered_products=ko.computed(function(){return ko.utils.arrayFilter(self.flat_products(),function(prod){var e=rootModel.effect();var w=rootModel.watt_per_meter();var m=rootModel.manufacturor();var f_e=false;var f_w=false;var f_m=false;if(!(w||e||m)){return self.flat_products();}
if(e){f_e=true;if(prod.effect==e){f_e=false;}}
if(m){f_m=true;if(prod.manufacturor==m){f_m=false;}}
if(w){f_w=true;if(prod.watt_per_meter==w){f_w=false;}}
return!(f_e||f_m||f_w);}).sort(function(a,b){return a.effect-b.effect;});});self.spec_groups=ko.computed(function(){var array=self.products();var w=[];var w_squared=[];for(var i=0;i<array.length;i++){if(!rootModel.manufacturor()||rootModel.manufacturor()===array[i].name){var m=array[i].product_types;for(var j=0;j<m.length;j++){var p=m[j];if('watt_per_meter'in p&&w.indexOf(p.watt_per_meter)==-1){w.push(p.watt_per_meter);}
if('watt_per_square_meter'in p&&w.indexOf(p.watt_per_square_meter)==-1){w_squared.push('watt_per_square_meter');}}}}
return{'watt_per_meter':w.sort(sortNumber),'watt_per_square_meter':w_squared};});self.getProducts=function(){$.get("/products.json",$('#form').serialize()).done(function(result){self.products(result);rootModel.selected_vk(rootModel.forced_selected_vk());}).fail(function(e){console.log('Could not retrieve data = Error '+e.status);});};}
function AppViewModel(){var self=this;ko.validation.init({decorateInputElement:true,errorElementClass:'has-error has-feedback',insertMessages:true,decorateElement:true,errorMessageClass:'bg-danger'});var init=ko.bindingHandlers['validationCore'].init;ko.bindingHandlers['validationCore'].init=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){init(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext);var config=ko.validation.utils.getConfigOptions(element);if(config.decorateInputElement&&ko.validation.utils.isValidatable(valueAccessor())){var parent=$(element).parent();if(parent.length){ko.applyBindingsToNode(parent[0],{validationElement:valueAccessor()});}}};self.anleggs_adresse=ko.observable().extend({required:true,minLength:3,});self.anleggs_poststed=ko.observable().extend({required:true,minLength:3,});self.anleggs_postnummer=ko.observable().extend({required:true,minLength:4,number:true,min:1000,max:9999,});self.manufacturor=ko.observable();self.watt_per_meter=ko.observable();self.rom_navn=ko.observable().extend({required:true,minLength:2,});self.areal=ko.observable().extend({number:true,min:0.1});self.oppvarmet_areal=ko.observable().extend({required:true,number:true,min:0.1});self.effect=ko.observable().extend({number:true,});self.ohm_a=ko.observable().extend({number:true,min:0,max:1000,});self.ohm_b=ko.observable().extend({number:true,min:0,max:1000,});self.ohm_c=ko.observable().extend({number:true,min:0,max:1000,});self.mohm_a=ko.observable();self.mohm_b=ko.observable();self.mohm_c=ko.observable();self.error_fields=ko.observableArray();self.error_message=ko.observable();self.file_download=ko.observable();self.last_sent_args=ko.observable();self.form_args=ko.observable($('#form').serialize());self.Products=ko.observable();self.selected_vk=ko.observable();self.forced_selected_vk=ko.observable();self.address_id=ko.observable();self.filled_form_modified_id=ko.observable();self.user_forms=ko.observableArray();self.company_forms=ko.observableArray();self.prefill=false;self.validation_errors=ko.validation.group(self);if(self.prefill){self.anleggs_adresse('Kingsroad 1');self.anleggs_postnummer(4321);self.anleggs_poststed('Kings place');self.rom_navn('Kings room');self.areal(1000);self.oppvarmet_areal(900);self.forced_selected_vk(3);self.ohm_a(1);self.ohm_b(2);self.ohm_c(3);self.mohm_a(true);self.mohm_b(true);self.mohm_c(true);}
self.init=function(){self.Products(new ProductModel(self));self.Products().getProducts();};$('body').on("change keyup paste click",'input',function(){self.form_args($('#form').serialize());});self.form_changed=ko.computed(function(){return self.form_args()!==self.last_sent_args();},this);ko.computed(function(){try{var f=self.Products().flat_products();if(f.length>0){get_user_forms();get_company_forms();}}catch(e){}finally{}});function get_user_forms(loading){self.loading.push('user_form')
$.get("/forms.json",{}).done(function(result){console.log(result);result.user_forms.prefix='user_forms';result.company_forms.prefix='company_forms';self.user_forms(result.user_forms);self.company_forms(result.company_forms);self.loading.remove('user_form')
console.log(self.user_forms());});}
function get_company_forms(){return false
$.get("/forms.json",{type:'company'}).done(function(result,d){self.company_forms(result);});}
self.get_product_by_id=function(id){var f=self.Products().flat_products();for(var i=0;i<f.length;i++){if(f[i].id==id){return f[i];}}};self.expand_mods=function(e,d){var t=$(d.target);var m=t.siblings('.modifications-table');var up='glyphicon-menu-up';var down='glyphicon-menu-down';m.toggleClass('hidden');if(m.hasClass('hidden')){t.removeClass(up);t.addClass(down);}else{t.removeClass(down);t.addClass(up);}};self.delete=ko.observable();self.confirmed_delete=function(e,d){self.delete('');self.loading.push('delete');$.ajax({url:'json/form_mod/'+e.id,type:'DELETE',id:e.id}).done(function(result,d){self.loading.remove('delete');get_user_forms();});};self.renamePrefix=function(e,d,f){}
self.edit_form=function(e){var f=e.request_form;console.log('dd');self.filled_form_modified_id(e.id);self.anleggs_adresse(f.anleggs_adresse);self.anleggs_postnummer(f.anleggs_postnummer);self.anleggs_poststed(f.anleggs_poststed);self.rom_navn(f.rom_navn);self.areal(f.areal);self.oppvarmet_areal(f.oppvarmet_areal);self.selected_vk(f.product_id);self.address_id(e.address_id);self.filled_form_modified_id(e.id);self.ohm_a(f.ohm_a);self.ohm_b(f.ohm_b);self.ohm_c(f.ohm_c);self.mohm_a(f.mohm_a);self.mohm_b(f.ohm_b);self.mohm_c(f.ohm_c);self.last_sent_args($('#form').serialize());self.form_args($('#form').serialize());$('.nav-tabs a[href="#main_form"]').tab('show');};self.post_form=function(e,t){self.form_args($('#form').serialize());if(self.validation_errors().length>0){self.validation_errors.showAllMessages();return false;}
if(self.form_changed()||!self.filled_form_modified_id()){self.loading.push('fill_form');$.post("/json/heating/",{'anleggs_adresse':self.anleggs_adresse(),'anleggs_poststed':self.anleggs_poststed(),'anleggs_postnummer':self.anleggs_postnummer(),'rom_navn':self.rom_navn(),'areal':self.areal(),'oppvarmet_areal':self.oppvarmet_areal(),'mohm_a':self.mohm_a(),'mohm_b':self.mohm_b(),'mohm_c':self.mohm_c(),'ohm_a':self.ohm_a(),'ohm_b':self.ohm_b(),'ohm_c':self.ohm_c(),'product_id':self.selected_vk(),'address_id':self.address_id(),'filled_form_modified_id':self.filled_form_modified_id()}).done(function(result){self.loading.remove('fill_form');parse_form_download(result);});}else{console.log(self.form_changed());self.loading.push('fill_form');$.get("/json/heating/",{'filled_form_modified_id':self.filled_form_modified_id()}).done(function(result){self.loading.remove('fill_form');parse_form_download(result);});}};function parse_form_download(result){console.log(result);self.last_sent_args(self.form_args());if(result.error_fields){self.error_fields(result.error_fields);}
if(result.file_download){self.file_download(result.file_download);if(result.address_id){self.address_id(result.address_id);}
if(result.filled_form_modified_id){self.filled_form_modified_id(result.filled_form_modified_id);}}
if(result.error_message){self.error_message(result.error_message);}}
self.loading=ko.observableArray();}
var myApp=new AppViewModel();myApp.init();ko.applyBindings(myApp);});self.format_date=function(dateString){var d_names=new Array("Søndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Søndag");var m_names=new Array("januar","februar","mars","april","mai","juni","juli","august","september","october","november","december");var d=new Date(dateString);var curr_day=d.getDay();var curr_date=d.getDate();var curr_month=d.getMonth();var curr_year=d.getFullYear();var curr_hour=d.getHours();var curr_minute=d.getMinutes();return curr_date+'. '+m_names[curr_month]+" "+curr_year+' '+
pad(curr_hour,2)+':'+pad(curr_minute,2)}
function pad(n,width,z){z=z||'0';n=n+'';return n.length>=width?n:new Array(width-n.length+1).join(z)+n;}
$(function(){$('input[type=tel]').on('input',function(e){this.value=this.value.replace(/\D/g,'');})})