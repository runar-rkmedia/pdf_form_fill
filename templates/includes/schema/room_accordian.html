<!DOCTYPE html>
<div class="panel-group" id="accordion-room">
  <!-- ko with: $data -->
  <div class="panel" data-bind="css: {'panel-primary': !modified(), 'panel-mod-flag': modified()}">
    <div class="panel-heading collapsed" data-toggle="collapse" aria-expanded="false" href="#room-form" aria-controls="#room-form">
      <h3 class="panel-title carrot">

        <span>
          <span data-bind="if: !name()">Nytt rom/sted</span>
          <span data-bind="text: name"></span>
          <span class="opaquelight">
            <!-- ko if: area && heated_area -->
            <span class="hidden-xs">&ensp;&mdash;&ensp;</span>
            <!-- /ko -->
            <!-- ko if: area -->
            <span class="hidden-xs" data-bind="text: area() + '&nbsp;m²'"></span>
            <!-- /ko -->
            <!-- ko if: heated_area -->
            <span class="hidden-xs" data-bind="text:'(' +  heated_area() + '&nbsp;m²)'"></span>
            <!-- /ko -->
            <!-- ko if: room_effect -->
            <span class="" data-bind="text:'&ensp;&mdash;&ensp;' +  room_effect() + '&nbsp;W'"></span>
            <!-- /ko -->
          </span>
          <!-- ko if: modified -->
          <b>Ikke lagret</b>
          <!-- /ko -->
          <!-- ko if: sub_modified -->
          <span class="icon-mod-flag" aria-hidden="true"></span>
          <!-- /ko -->
        </span>
      </h3>
    </div>
    <div class="panel" role="tabpanel">
      <div class="panel-body">
        <div class="collapse" id="room-form">
          <div class="well well-sm">
            <div class="row">
              <div class="col-xs-12">
                <button type="button" class="close close-dark pull-right" aria-label="Close" data-bind="click: function(d,e){$(e.target).closest('.collapse').collapse('toggle')}">
                  <span aria-hidden="true">&times;</span>
                </button>
                <!-- ko template: { name: 'room_form_template', data: $data} -->
                <!-- /ko -->
                <!-- ko if: bestFitEffect() -->
                <div data-bind="text: 'Ideell effekt: ' + bestFitEffect().toFixed(0) + 'W'"></div>
                <!-- /ko -->
              </div>
            </div>
          </div>
        </div>
        <!-- ko if: id() >= 0 -->
        <div class="well well-sm">
          <div class="row">
            <div class="col-xs-12">
              <h2 class="justified">Varmekabler
                <button type="button" class="btn btn-sm btn-primary" data-bind="click: function (d, e){heating_cables().add(e)}">
                  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                  <span class="hidden-xs">Legg til varmekabel</span></button>
              </h2>
            </div>
          </div>
          <div class="select_products" data-bind="if: id() >= 0">
            <!-- ko with: heating_cables().list() -->
            {% include 'includes/schema/heating_cable.html' %}
            <!-- /ko -->

            <!-- ko ifnot: heating_cables().list().length -->
            <div class="well well-sm ">Ingen varmekabler lagt til enda. Du kan legge til en ved å trykke på knappen ovenfor.
            </div>
            <!-- /ko -->
          </div>
        </div>
        <hr>
        <h2>Sjekkliste</h2>
        <div class="bs-callout bs-callout-info">
          <p>Denne sjekklisten gjelder for alle kablene i dette rommet/stedet.</p>
          <p>Kun de påkrevde feltene vises.</p>
        </div>
        <div class="row">
          <div class="col-xs-6">
            <label data-bind="css: { 'label-mod-flag': curcuit_breaker_size.modified() }"><br class="visible-xs-inline">Sikringsstørrelse</label>
            <select class="form-control col-xs-12" data-bind="options: $root.curcuit_breaker_list,
                            optionsText: 'text',
                            optionsValue: 'id',
                            value: curcuit_breaker_size"></select>
          </div>
          <div class="col-xs-6">
            <div class="form-group">
              <label data-bind="css: { 'label-mod-flag': ground_fault_protection.modified() }">Utløserstrøm<br class="visible-xs-inline">
                jordfeil</label>
              <input type="number" min="0" data-bind="textInput:ground_fault_protection" class="form-control">
            </div>
          </div>
        </div>
        <hr>
        <div class="row">
          <div class="col-xs-12">
            <div class="form-group">
              <label data-bind="css: { 'label-mod-flag': installation_depth.modified() }">Montasjedybde (mm)</label>
              <input type="number" min="0" data-bind="textInput: installation_depth" class="form-control">
            </div>
          </div>
        </div>
        <fieldset>
          <legend>Jording</legend>
          {{render_field( roomForm.check_earthed.cable_screen, class_='checkbox', label_class='checkbox-inline', formgroup=None, **{'data-bind':"checked: earthed_cable_screen"}) }}
          {{render_field( roomForm.check_earthed.chicken_wire, class_='checkbox', label_class='checkbox-inline', formgroup=None, **{'data-bind':"checked: earthed_chicken_wire"}) }}
          {{render_field( roomForm.check_earthed.other, formgroup='form-group', **{'data-bind':"textInput: earthed_other"}) }}
        </fieldset>
        <fieldset>
          <legend>Max temperatur</legend>
          <p >Maks temperatur i opppvarmingssystemet er begrenset til 80˚C ved</p>

          {{render_field( roomForm.check_max_temp.planning, class_='checkbox', formgroup='checkbox', **{'data-bind':"checked: max_temp_limited_by_planning"}) }}
          {{render_field( roomForm.check_max_temp.installation, class_='checkbox', formgroup='checkbox', **{'data-bind':"checked: max_temp_limited_by_installation"}) }}
          {{render_field( roomForm.check_max_temp.other, formgroup='form-group', **{'data-bind':"textInput: max_temp_limited_by_other"}) }}
        </fieldset>
        <fieldset>
          <legend>Styresystem</legend>

          {{render_field( roomForm.check_control_system.designation, formgroup='form-group', **{'data-bind':"textInput: control_system_designation"}) }}
          {{render_field( roomForm.check_control_system.floor_sensor, class_='checkbox-inline', formgroup='checkbox-inline', **{'data-bind':"checked: control_system_floor_sensor"}) }}
          {{render_field( roomForm.check_control_system.room_sensor, class_='checkbox-inline', formgroup='checkbox-inline', **{'data-bind':"checked: control_system_room_sensor"}) }}
          {{render_field( roomForm.check_control_system.other, formgroup='form-group', **{'data-bind':"textInput: control_system_other"}) }}
        </fieldset>

        <div class="row">
          <div class="col-xs-12">
            <div class="text-right">
              <button
                type="button"
                class="btn btn-primary"
                data-bind=" click: post, css: {opaque: !validationModel.isValid() || !modified()}, enable: modified() && validationModel.isValid(), text: id() >= 0 ? 'Endre' : 'Lagre'"
                data-loading-text="
                <span class='glyphicon glyphicon-refresh spinning'></span>"></button>

            </div>
          </div>
        </div>
        <!-- /ko -->
      </div>
    </div>
  </div>
  <!-- /ko -->
</div>
